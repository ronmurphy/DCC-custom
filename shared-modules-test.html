<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Modules Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
        }
        .status-ok { color: #4ade80; }
        .status-error { color: #f87171; }
        .status-warning { color: #fbbf24; }
        pre {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Shared Modules Test</h1>
    
    <div class="test-section">
        <h2>üì¶ Module Loading Status</h2>
        <div id="moduleStatus"></div>
    </div>

    <div class="test-section">
        <h2>üé® Chat Picker Manager Test</h2>
        <div id="chatPickerStatus"></div>
        <button onclick="testChatPicker()" id="testPickerBtn">Test Chat Picker</button>
    </div>

    <div class="test-section">
        <h2>üòä Emoji Consistency Check</h2>
        <div id="emojiConsistency"></div>
    </div>

    <script src="shared-modules/chatPickerManager.js"></script>
    <script src="shared-modules/v4NetworkChatPickerIntegration.js"></script>
    <script src="V4-network/js/modules/emojiProcessor.js"></script>
    <script>
        function checkModules() {
            const modules = {
                'ChatPickerManager': typeof window.ChatPickerManager !== 'undefined',
                'chatPickerManager': typeof window.chatPickerManager !== 'undefined',
                'emojiProcessor': typeof window.emojiProcessor !== 'undefined',
                'showSheetChatEffects': typeof window.showSheetChatEffects === 'function',
                'initializeChatPicker': typeof window.initializeChatPicker === 'function'
            };

            let html = '<ul>';
            Object.entries(modules).forEach(([name, loaded]) => {
                const status = loaded ? '‚úÖ' : '‚ùå';
                const className = loaded ? 'status-ok' : 'status-error';
                html += `<li class="${className}">${status} ${name}</li>`;
            });
            html += '</ul>';

            document.getElementById('moduleStatus').innerHTML = html;
            return modules;
        }

        function testChatPicker() {
            const status = document.getElementById('chatPickerStatus');
            
            try {
                if (typeof window.initializeChatPicker === 'function') {
                    const picker = window.initializeChatPicker({ isMobile: true, theme: 'mobile' });
                    status.innerHTML = '<span class="status-ok">‚úÖ Chat picker initialized successfully</span>';
                    
                    // Test emoji categories
                    if (picker && picker.emojiCategories) {
                        const categories = Object.keys(picker.emojiCategories);
                        status.innerHTML += `<br><span class="status-ok">üìÇ Categories: ${categories.join(', ')}</span>`;
                    }
                } else {
                    status.innerHTML = '<span class="status-error">‚ùå initializeChatPicker not available</span>';
                }
            } catch (error) {
                status.innerHTML = `<span class="status-error">‚ùå Error: ${error.message}</span>`;
            }
        }

        function checkEmojiConsistency() {
            const container = document.getElementById('emojiConsistency');
            
            // Test emoji codes from the fix file
            const testCodes = [
                ':boom:', ':spell:', ':treasure:', ':skull:', 
                ':dice:', ':mp:', ':fumble:', ':ice:'
            ];

            let html = '<h3>Code Processing Test:</h3>';
            
            if (window.emojiProcessor) {
                testCodes.forEach(code => {
                    const processed = window.emojiProcessor.processMessage(code);
                    const isConverted = processed !== code;
                    const status = isConverted ? '‚úÖ' : '‚ùå';
                    const className = isConverted ? 'status-ok' : 'status-error';
                    
                    html += `<div class="${className}">${status} ${code} ‚Üí ${processed}</div>`;
                });
            } else {
                html += '<div class="status-error">‚ùå EmojiProcessor not loaded</div>';
            }

            // Test shared chat picker emoji categories
            if (window.chatPickerManager && window.chatPickerManager.emojiCategories) {
                html += '<h3>Shared Categories:</h3>';
                Object.entries(window.chatPickerManager.emojiCategories).forEach(([category, data]) => {
                    html += `<div class="status-ok">‚úÖ ${data.name} (${data.emojis.length} emojis)</div>`;
                });
            }

            container.innerHTML = html;
        }

        // Run tests when page loads
        window.addEventListener('load', () => {
            console.log('üß™ Starting shared modules tests...');
            checkModules();
            
            setTimeout(() => {
                checkEmojiConsistency();
            }, 500);
        });
    </script>
</body>
</html>
